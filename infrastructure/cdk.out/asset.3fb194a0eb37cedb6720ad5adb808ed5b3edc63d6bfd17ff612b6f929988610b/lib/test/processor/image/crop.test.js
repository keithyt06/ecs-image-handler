"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const sharp = require("sharp");
const crop_1 = require("../../../src/processor/image/crop");
const utils_1 = require("./utils");
test('crop action validate', () => {
    const action = new crop_1.CropAction();
    const param1 = action.validate('crop,x_1,y_2,w_3,h_4'.split(','));
    expect(param1).toEqual({
        x: 1,
        y: 2,
        w: 3,
        h: 4,
        g: 'nw',
    });
    const param2 = action.validate('crop,x_10,y_20,w_30,h_40,g_se'.split(','));
    expect(param2).toEqual({
        x: 10,
        y: 20,
        w: 30,
        h: 40,
        g: 'se',
    });
    expect(() => {
        action.validate('crop'.split(','));
    }).toThrowError(/Crop param error, e.g: crop,x_100,y_50/);
    expect(() => {
        action.validate('crop,xx'.split(','));
    }).toThrowError(/Unkown param: /);
    expect(() => {
        action.validate('crop,w_0'.split(','));
    }).toThrowError(/Crop param w must be greater than  0/);
    expect(() => {
        action.validate('crop,w_-2'.split(','));
    }).toThrowError(/Crop param w must be greater than  0/);
    expect(() => {
        action.validate('crop,h_0'.split(','));
    }).toThrowError(/Crop param h must be greater than  0/);
    expect(() => {
        action.validate('crop,h_-1'.split(','));
    }).toThrowError(/Crop param h must be greater than  0/);
    expect(() => {
        action.validate('crop,x_-1'.split(','));
    }).toThrowError(/Crop param x must be greater than or equal to 0/);
    expect(() => {
        action.validate('crop,y_-1'.split(','));
    }).toThrowError(/Crop param y must be greater than or equal to 0/);
    expect(() => {
        action.validate('crop,g_abc'.split(','));
    }).toThrowError(/Crop param g must be one of nw, north, ne, west, center, east, sw, south, se./);
});
test('crop action', async () => {
    const ctx = await (0, utils_1.mkctx)('example.jpg');
    const action = new crop_1.CropAction();
    void expect(action.process(ctx, 'crop,x_10000,y_10,g_nw'.split(','))).rejects.toThrowError(/Incorrect crop param, x value must be in/);
    void expect(action.process(ctx, 'crop,x_10,y_100000,g_nw'.split(','))).rejects.toThrowError(/Incorrect crop param, y value must be in/);
});
test('crop action', async () => {
    const image = sharp((await utils_1.fixtureStore.get('example.jpg')).buffer);
    const metadata = await image.metadata();
    if (metadata.height === undefined || metadata.width === undefined) {
        throw new Error('Can\'t get image width/height');
    }
    const ctx = await (0, utils_1.mkctx)('example.jpg');
    const action = new crop_1.CropAction();
    await action.process(ctx, 'crop,x_10,y_10'.split(','));
    const { info } = await ctx.image.toBuffer({ resolveWithObject: true });
    expect(info.width).toBe(metadata.width - 10);
    expect(info.height).toBe(metadata.height - 10);
});
test('crop action', async () => {
    const image = sharp((await utils_1.fixtureStore.get('example.jpg')).buffer);
    const metadata = await image.metadata();
    if (metadata.height === undefined || metadata.width === undefined) {
        throw new Error('Can\'t get image width/height');
    }
    const ctx = await (0, utils_1.mkctx)('example.jpg');
    const action = new crop_1.CropAction();
    await action.process(ctx, 'crop,x_0,y_0,g_north'.split(','));
    const { info } = await ctx.image.toBuffer({ resolveWithObject: true });
    expect(info.width).toBe(Math.round(metadata.width / 3 * 2));
    expect(info.height).toBe(metadata.height);
});
test('crop action', async () => {
    const image = sharp((await utils_1.fixtureStore.get('example.jpg')).buffer);
    const metadata = await image.metadata();
    if (metadata.height === undefined || metadata.width === undefined) {
        throw new Error('Can\'t get image width/height');
    }
    const ctx = await (0, utils_1.mkctx)('example.jpg');
    const action = new crop_1.CropAction();
    await action.process(ctx, 'crop,x_0,y_0,g_north'.split(','));
    const { info } = await ctx.image.toBuffer({ resolveWithObject: true });
    expect(info.width).toBe(Math.round(metadata.width / 3 * 2));
    expect(info.height).toBe(metadata.height);
});
test('crop action', async () => {
    const image = sharp((await utils_1.fixtureStore.get('example.jpg')).buffer);
    const metadata = await image.metadata();
    if (metadata.height === undefined || metadata.width === undefined) {
        throw new Error('Can\'t get image width/height');
    }
    const ctx = await (0, utils_1.mkctx)('example.jpg');
    const action = new crop_1.CropAction();
    await action.process(ctx, 'crop,x_0,y_20,g_ne'.split(','));
    const { info } = await ctx.image.toBuffer({ resolveWithObject: true });
    expect(info.width >= Math.round(metadata.width / 3));
    expect(info.height).toBe(metadata.height - 20);
});
test('crop action', async () => {
    const image = sharp((await utils_1.fixtureStore.get('example.jpg')).buffer);
    const metadata = await image.metadata();
    if (metadata.height === undefined || metadata.width === undefined) {
        throw new Error('Can\'t get image width/height');
    }
    const ctx = await (0, utils_1.mkctx)('example.jpg');
    const action = new crop_1.CropAction();
    await action.process(ctx, 'crop,x_0,y_0,g_west'.split(','));
    const { info } = await ctx.image.toBuffer({ resolveWithObject: true });
    expect(info.width).toBe(Math.round(metadata.width));
    expect(info.height).toBe(Math.round(metadata.height / 3) * 2);
});
test('crop action', async () => {
    const image = sharp((await utils_1.fixtureStore.get('example.jpg')).buffer);
    const metadata = await image.metadata();
    if (metadata.height === undefined || metadata.width === undefined) {
        throw new Error('Can\'t get image width/height');
    }
    const ctx = await (0, utils_1.mkctx)('example.jpg');
    const action = new crop_1.CropAction();
    await action.process(ctx, 'crop,x_0,y_0,g_se'.split(','));
    const { info } = await ctx.image.toBuffer({ resolveWithObject: true });
    expect(info.width >= Math.round(metadata.width / 3));
    expect(info.height >= Math.round(metadata.height / 3));
});
test('crop action', async () => {
    const image = sharp((await utils_1.fixtureStore.get('example.jpg')).buffer);
    const metadata = await image.metadata();
    if (metadata.height === undefined || metadata.width === undefined) {
        throw new Error('Can\'t get image width/height');
    }
    const ctx = await (0, utils_1.mkctx)('example.jpg');
    const action = new crop_1.CropAction();
    await action.process(ctx, 'crop,x_0,y_0,w_10000,h_10000'.split(','));
    const { info } = await ctx.image.toBuffer({ resolveWithObject: true });
    expect(info.width).toBe(metadata.width);
    expect(info.height).toBe(metadata.height);
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY3JvcC50ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vdGVzdC9wcm9jZXNzb3IvaW1hZ2UvY3JvcC50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsK0JBQStCO0FBQy9CLDREQUErRDtBQUMvRCxtQ0FBOEM7QUFFOUMsSUFBSSxDQUFDLHNCQUFzQixFQUFFLEdBQUcsRUFBRTtJQUNoQyxNQUFNLE1BQU0sR0FBRyxJQUFJLGlCQUFVLEVBQUUsQ0FBQztJQUNoQyxNQUFNLE1BQU0sR0FBRyxNQUFNLENBQUMsUUFBUSxDQUFDLHNCQUFzQixDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO0lBQ2xFLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLENBQUM7UUFDckIsQ0FBQyxFQUFFLENBQUM7UUFDSixDQUFDLEVBQUUsQ0FBQztRQUNKLENBQUMsRUFBRSxDQUFDO1FBQ0osQ0FBQyxFQUFFLENBQUM7UUFDSixDQUFDLEVBQUUsSUFBSTtLQUNSLENBQUMsQ0FBQztJQUdILE1BQU0sTUFBTSxHQUFHLE1BQU0sQ0FBQyxRQUFRLENBQUMsK0JBQStCLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7SUFDM0UsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQztRQUNyQixDQUFDLEVBQUUsRUFBRTtRQUNMLENBQUMsRUFBRSxFQUFFO1FBQ0wsQ0FBQyxFQUFFLEVBQUU7UUFDTCxDQUFDLEVBQUUsRUFBRTtRQUNMLENBQUMsRUFBRSxJQUFJO0tBQ1IsQ0FBQyxDQUFDO0lBR0gsTUFBTSxDQUFDLEdBQUcsRUFBRTtRQUNWLE1BQU0sQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO0lBQ3JDLENBQUMsQ0FBQyxDQUFDLFlBQVksQ0FBQyx3Q0FBd0MsQ0FBQyxDQUFDO0lBRTFELE1BQU0sQ0FBQyxHQUFHLEVBQUU7UUFD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aW9uIH0gZnJvbSAnLi4vLi4vLi4vc3JjL3Byb2Nlc3Nvci9pbWFnZS9jcm9wJztcbmltcG9ydCB7IGZpeHR1cmVTdG9yZSwgbWtjdHggfSBmcm9tICcuL3V0aWxzJztcblxudGVzdCgnY3JvcCBhY3Rpb24gdmFsaWRhdGUnLCAoKSA9PiB7XG4gIGNvbnN0IGFjdGlvbiA9IG5ldyBDcm9wQWN0aW9uKCk7XG4gIGNvbnN0IHBhcmFtMSA9IGFjdGlvbi52YWxpZGF0ZSgnY3JvcCx4XzEseV8yLHdfMyxoXzQnLnNwbGl0KCcsJykpO1xuICBleHBlY3QocGFyYW0xKS50b0VxdWFsKHtcbiAgICB4OiAxLFxuICAgIHk6IDIsXG4gICAgdzogMyxcbiAgICBoOiA0LFxuICAgIGc6ICdudycsXG4gIH0pO1xuXG5cbiAgY29uc3QgcGFyYW0yID0gYWN0aW9uLnZhbGlkYXRlKCdjcm9wLHhfMTAseV8yMCx3XzMwLGhfNDAsZ19zZScuc3BsaXQoJywnKSk7XG4gIGV4cGVjdChwYXJhbTIpLnRvRXF1YWwoe1xuICAgIHg6IDEwLFxuICAgIHk6IDIwLFxuICAgIHc6IDMwLFxuICAgIGg6IDQwLFxuICAgIGc6ICdzZScsXG4gIH0pO1xuXG5cbiAgZXhwZWN0KCgpID0+IHtcbiAgICBhY3Rpb24udmFsaWRhdGUoJ2Nyb3AnLnNwbGl0KCcsJykpO1xuICB9KS50b1Rocm93RXJyb3IoL0Nyb3AgcGFyYW0gZXJyb3IsIGUuZzogY3JvcCx4XzEwMCx5XzUwLyk7XG5cbiAgZXhwZWN0KCgpID0+IHtcbiAgICBhY3Rpb24udmFsaWRhdGUoJ2Nyb3AseHgnLnNwbGl0KCcsJykpO1xuICB9KS50b1Rocm93RXJyb3IoL1Vua293biBwYXJhbTogLyk7XG5cblxuICBleHBlY3QoKCkgPT4ge1xuICAgIGFjdGlvbi52YWxpZGF0ZSgnY3JvcCx3XzAnLnNwbGl0KCcsJykpO1xuICB9KS50b1Rocm93RXJyb3IoL0Nyb3AgcGFyYW0gdyBtdXN0IGJlIGdyZWF0ZXIgdGhhbiAgMC8pO1xuXG4gIGV4cGVjdCgoKSA9PiB7XG4gICAgYWN0aW9uLnZhbGlkYXRlKCdjcm9wLHdfLTInLnNwbGl0KCcsJykpO1xuICB9KS50b1Rocm93RXJyb3IoL0Nyb3AgcGFyYW0gdyBtdXN0IGJlIGdyZWF0ZXIgdGhhbiAgMC8pO1xuXG5cbiAgZXhwZWN0KCgpID0+IHtcbiAgICBhY3Rpb24udmFsaWRhdGUoJ2Nyb3AsaF8wJy5zcGxpdCgnLCcpKTtcbiAgfSkudG9UaHJvd0Vycm9yKC9Dcm9wIHBhcmFtIGggbXVzdCBiZSBncmVhdGVyIHRoYW4gIDAvKTtcblxuICBleHBlY3QoKCkgPT4ge1xuICAgIGFjdGlvbi52YWxpZGF0ZSgnY3JvcCxoXy0xJy5zcGxpdCgnLCcpKTtcbiAgfSkudG9UaHJvd0Vycm9yKC9Dcm9wIHBhcmFtIGggbXVzdCBiZSBncmVhdGVyIHRoYW4gIDAvKTtcblxuXG4gIGV4cGVjdCgoKSA9PiB7XG4gICAgYWN0aW9uLnZhbGlkYXRlKCdjcm9wLHhfLTEnLnNwbGl0KCcsJykpO1xuICB9KS50b1Rocm93RXJyb3IoL0Nyb3AgcGFyYW0geCBtdXN0IGJlIGdyZWF0ZXIgdGhhbiBvciBlcXVhbCB0byAwLyk7XG5cblxuICBleHBlY3QoKCkgPT4ge1xuICAgIGFjdGlvbi52YWxpZGF0ZSgnY3JvcCx5Xy0xJy5zcGxpdCgnLCcpKTtcbiAgfSkudG9UaHJvd0Vycm9yKC9Dcm9wIHBhcmFtIHkgbXVzdCBiZSBncmVhdGVyIHRoYW4gb3IgZXF1YWwgdG8gMC8pO1xuXG5cbiAgZXhwZWN0KCgpID0+IHtcbiAgICBhY3Rpb24udmFsaWRhdGUoJ2Nyb3AsZ19hYmMnLnNwbGl0KCcsJykpO1xuICB9KS50b1Rocm93RXJyb3IoL0Nyb3AgcGFyYW0gZyBtdXN0IGJlIG9uZSBvZiBudywgbm9ydGgsIG5lLCB3ZXN0LCBjZW50ZXIsIGVhc3QsIHN3LCBzb3V0aCwgc2UuLyk7XG5cblxufSk7XG5cblxudGVzdCgnY3JvcCBhY3Rpb24nLCBhc3luYyAoKSA9PiB7XG4gIGNvbnN0IGN0eCA9IGF3YWl0IG1rY3R4KCdleGFtcGxlLmpwZycpO1xuICBjb25zdCBhY3Rpb24gPSBuZXcgQ3JvcEFjdGlvbigpO1xuICB2b2lkIGV4cGVjdChhY3Rpb24ucHJvY2VzcyhjdHgsICdjcm9wLHhfMTAwMDAseV8xMCxnX253Jy5zcGxpdCgnLCcpKSkucmVqZWN0cy50b1Rocm93RXJyb3IoL0luY29ycmVjdCBjcm9wIHBhcmFtLCB4IHZhbHVlIG11c3QgYmUgaW4vKTtcbiAgdm9pZCBleHBlY3QoYWN0aW9uLnByb2Nlc3MoY3R4LCAnY3JvcCx4XzEwLHlfMTAwMDAwLGdfbncnLnNwbGl0KCcsJykpKS5yZWplY3RzLnRvVGhyb3dFcnJvcigvSW5jb3JyZWN0IGNyb3AgcGFyYW0sIHkgdmFsdWUgbXVzdCBiZSBpbi8pO1xufSk7XG5cbnRlc3QoJ2Nyb3AgYWN0aW9uJywgYXN5bmMgKCkgPT4ge1xuICBjb25zdCBpbWFnZSA9IHNoYXJwKChhd2FpdCBmaXh0dXJlU3RvcmUuZ2V0KCdleGFtcGxlLmpwZycpKS5idWZmZXIpO1xuICBjb25zdCBtZXRhZGF0YSA9IGF3YWl0IGltYWdlLm1ldGFkYXRhKCk7XG4gIGlmIChtZXRhZGF0YS5oZWlnaHQgPT09IHVuZGVmaW5lZCB8fCBtZXRhZGF0YS53aWR0aCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdDYW5cXCd0IGdldCBpbWFnZSB3aWR0aC9oZWlnaHQnKTtcbiAgfVxuICBjb25zdCBjdHggPSBhd2FpdCBta2N0eCgnZXhhbXBsZS5qcGcnKTtcbiAgY29uc3QgYWN0aW9uID0gbmV3IENyb3BBY3Rpb24oKTtcbiAgYXdhaXQgYWN0aW9uLnByb2Nlc3MoY3R4LCAnY3JvcCx4XzEwLHlfMTAnLnNwbGl0KCcsJykpO1xuICBjb25zdCB7IGluZm8gfSA9IGF3YWl0IGN0eC5pbWFnZS50b0J1ZmZlcih7IHJlc29sdmVXaXRoT2JqZWN0OiB0cnVlIH0pO1xuICBleHBlY3QoaW5mby53aWR0aCkudG9CZShtZXRhZGF0YS53aWR0aCAtIDEwKTtcbiAgZXhwZWN0KGluZm8uaGVpZ2h0KS50b0JlKG1ldGFkYXRhLmhlaWdodCAtIDEwKTtcbn0pO1xuXG50ZXN0KCdjcm9wIGFjdGlvbicsIGFzeW5jICgpID0+IHtcbiAgY29uc3QgaW1hZ2UgPSBzaGFycCgoYXdhaXQgZml4dHVyZVN0b3JlLmdldCgnZXhhbXBsZS5qcGcnKSkuYnVmZmVyKTtcbiAgY29uc3QgbWV0YWRhdGEgPSBhd2FpdCBpbWFnZS5tZXRhZGF0YSgpO1xuICBpZiAobWV0YWRhdGEuaGVpZ2h0ID09PSB1bmRlZmluZWQgfHwgbWV0YWRhdGEud2lkdGggPT09IHVuZGVmaW5lZCkge1xuICAgIHRocm93IG5ldyBFcnJvcignQ2FuXFwndCBnZXQgaW1hZ2Ugd2lkdGgvaGVpZ2h0Jyk7XG4gIH1cbiAgY29uc3QgY3R4ID0gYXdhaXQgbWtjdHgoJ2V4YW1wbGUuanBnJyk7XG4gIGNvbnN0IGFjdGlvbiA9IG5ldyBDcm9wQWN0aW9uKCk7XG4gIGF3YWl0IGFjdGlvbi5wcm9jZXNzKGN0eCwgJ2Nyb3AseF8wLHlfMCxnX25vcnRoJy5zcGxpdCgnLCcpKTtcbiAgY29uc3QgeyBpbmZvIH0gPSBhd2FpdCBjdHguaW1hZ2UudG9CdWZmZXIoeyByZXNvbHZlV2l0aE9iamVjdDogdHJ1ZSB9KTtcbiAgZXhwZWN0KGluZm8ud2lkdGgpLnRvQmUoTWF0aC5yb3VuZChtZXRhZGF0YS53aWR0aCAvIDMgKiAyKSk7XG4gIGV4cGVjdChpbmZvLmhlaWdodCkudG9CZShtZXRhZGF0YS5oZWlnaHQpO1xufSk7XG5cbnRlc3QoJ2Nyb3AgYWN0aW9uJywgYXN5bmMgKCkgPT4ge1xuICBjb25zdCBpbWFnZSA9IHNoYXJwKChhd2FpdCBmaXh0dXJlU3RvcmUuZ2V0KCdleGFtcGxlLmpwZycpKS5idWZmZXIpO1xuICBjb25zdCBtZXRhZGF0YSA9IGF3YWl0IGltYWdlLm1ldGFkYXRhKCk7XG4gIGlmIChtZXRhZGF0YS5oZWlnaHQgPT09IHVuZGVmaW5lZCB8fCBtZXRhZGF0YS53aWR0aCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdDYW5cXCd0IGdldCBpbWFnZSB3aWR0aC9oZWlnaHQnKTtcbiAgfVxuICBjb25zdCBjdHggPSBhd2FpdCBta2N0eCgnZXhhbXBsZS5qcGcnKTtcbiAgY29uc3QgYWN0aW9uID0gbmV3IENyb3BBY3Rpb24oKTtcbiAgYXdhaXQgYWN0aW9uLnByb2Nlc3MoY3R4LCAnY3JvcCx4XzAseV8wLGdfbm9ydGgnLnNwbGl0KCcsJykpO1xuICBjb25zdCB7IGluZm8gfSA9IGF3YWl0IGN0eC5pbWFnZS50b0J1ZmZlcih7IHJlc29sdmVXaXRoT2JqZWN0OiB0cnVlIH0pO1xuICBleHBlY3QoaW5mby53aWR0aCkudG9CZShNYXRoLnJvdW5kKG1ldGFkYXRhLndpZHRoIC8gMyAqIDIpKTtcbiAgZXhwZWN0KGluZm8uaGVpZ2h0KS50b0JlKG1ldGFkYXRhLmhlaWdodCk7XG59KTtcblxuXG50ZXN0KCdjcm9wIGFjdGlvbicsIGFzeW5jICgpID0+IHtcbiAgY29uc3QgaW1hZ2UgPSBzaGFycCgoYXdhaXQgZml4dHVyZVN0b3JlLmdldCgnZXhhbXBsZS5qcGcnKSkuYnVmZmVyKTtcbiAgY29uc3QgbWV0YWRhdGEgPSBhd2FpdCBpbWFnZS5tZXRhZGF0YSgpO1xuICBpZiAobWV0YWRhdGEuaGVpZ2h0ID09PSB1bmRlZmluZWQgfHwgbWV0YWRhdGEud2lkdGggPT09IHVuZGVmaW5lZCkge1xuICAgIHRocm93IG5ldyBFcnJvcignQ2FuXFwndCBnZXQgaW1hZ2Ugd2lkdGgvaGVpZ2h0Jyk7XG4gIH1cbiAgY29uc3QgY3R4ID0gYXdhaXQgbWtjdHgoJ2V4YW1wbGUuanBnJyk7XG4gIGNvbnN0IGFjdGlvbiA9IG5ldyBDcm9wQWN0aW9uKCk7XG4gIGF3YWl0IGFjdGlvbi5wcm9jZXNzKGN0eCwgJ2Nyb3AseF8wLHlfMjAsZ19uZScuc3BsaXQoJywnKSk7XG4gIGNvbnN0IHsgaW5mbyB9ID0gYXdhaXQgY3R4LmltYWdlLnRvQnVmZmVyKHsgcmVzb2x2ZVdpdGhPYmplY3Q6IHRydWUgfSk7XG4gIGV4cGVjdChpbmZvLndpZHRoID49IE1hdGgucm91bmQobWV0YWRhdGEud2lkdGggLyAzKSk7XG4gIGV4cGVjdChpbmZvLmhlaWdodCkudG9CZShtZXRhZGF0YS5oZWlnaHQgLSAyMCk7XG59KTtcblxuXG50ZXN0KCdjcm9wIGFjdGlvbicsIGFzeW5jICgpID0+IHtcbiAgY29uc3QgaW1hZ2UgPSBzaGFycCgoYXdhaXQgZml4dHVyZVN0b3JlLmdldCgnZXhhbXBsZS5qcGcnKSkuYnVmZmVyKTtcbiAgY29uc3QgbWV0YWRhdGEgPSBhd2FpdCBpbWFnZS5tZXRhZGF0YSgpO1xuICBpZiAobWV0YWRhdGEuaGVpZ2h0ID09PSB1bmRlZmluZWQgfHwgbWV0YWRhdGEud2lkdGggPT09IHVuZGVmaW5lZCkge1xuICAgIHRocm93IG5ldyBFcnJvcignQ2FuXFwndCBnZXQgaW1hZ2Ugd2lkdGgvaGVpZ2h0Jyk7XG4gIH1cbiAgY29uc3QgY3R4ID0gYXdhaXQgbWtjdHgoJ2V4YW1wbGUuanBnJyk7XG4gIGNvbnN0IGFjdGlvbiA9IG5ldyBDcm9wQWN0aW9uKCk7XG4gIGF3YWl0IGFjdGlvbi5wcm9jZXNzKGN0eCwgJ2Nyb3AseF8wLHlfMCxnX3dlc3QnLnNwbGl0KCcsJykpO1xuICBjb25zdCB7IGluZm8gfSA9IGF3YWl0IGN0eC5pbWFnZS50b0J1ZmZlcih7IHJlc29sdmVXaXRoT2JqZWN0OiB0cnVlIH0pO1xuICBleHBlY3QoaW5mby53aWR0aCkudG9CZShNYXRoLnJvdW5kKG1ldGFkYXRhLndpZHRoKSk7XG4gIGV4cGVjdChpbmZvLmhlaWdodCkudG9CZShNYXRoLnJvdW5kKG1ldGFkYXRhLmhlaWdodCAvIDMpICogMik7XG59KTtcblxuXG50ZXN0KCdjcm9wIGFjdGlvbicsIGFzeW5jICgpID0+IHtcbiAgY29uc3QgaW1hZ2UgPSBzaGFycCgoYXdhaXQgZml4dHVyZVN0b3JlLmdldCgnZXhhbXBsZS5qcGcnKSkuYnVmZmVyKTtcbiAgY29uc3QgbWV0YWRhdGEgPSBhd2FpdCBpbWFnZS5tZXRhZGF0YSgpO1xuICBpZiAobWV0YWRhdGEuaGVpZ2h0ID09PSB1bmRlZmluZWQgfHwgbWV0YWRhdGEud2lkdGggPT09IHVuZGVmaW5lZCkge1xuICAgIHRocm93IG5ldyBFcnJvcignQ2FuXFwndCBnZXQgaW1hZ2Ugd2lkdGgvaGVpZ2h0Jyk7XG4gIH1cbiAgY29uc3QgY3R4ID0gYXdhaXQgbWtjdHgoJ2V4YW1wbGUuanBnJyk7XG4gIGNvbnN0IGFjdGlvbiA9IG5ldyBDcm9wQWN0aW9uKCk7XG4gIGF3YWl0IGFjdGlvbi5wcm9jZXNzKGN0eCwgJ2Nyb3AseF8wLHlfMCxnX3NlJy5zcGxpdCgnLCcpKTtcbiAgY29uc3QgeyBpbmZvIH0gPSBhd2FpdCBjdHguaW1hZ2UudG9CdWZmZXIoeyByZXNvbHZlV2l0aE9iamVjdDogdHJ1ZSB9KTtcbiAgZXhwZWN0KGluZm8ud2lkdGggPj0gTWF0aC5yb3VuZChtZXRhZGF0YS53aWR0aCAvIDMpKTtcbiAgZXhwZWN0KGluZm8uaGVpZ2h0ID49IE1hdGgucm91bmQobWV0YWRhdGEuaGVpZ2h0IC8gMykpO1xufSk7XG5cblxudGVzdCgnY3JvcCBhY3Rpb24nLCBhc3luYyAoKSA9PiB7XG4gIGNvbnN0IGltYWdlID0gc2hhcnAoKGF3YWl0IGZpeHR1cmVTdG9yZS5nZXQoJ2V4YW1wbGUuanBnJykpLmJ1ZmZlcik7XG4gIGNvbnN0IG1ldGFkYXRhID0gYXdhaXQgaW1hZ2UubWV0YWRhdGEoKTtcbiAgaWYgKG1ldGFkYXRhLmhlaWdodCA9PT0gdW5kZWZpbmVkIHx8IG1ldGFkYXRhLndpZHRoID09PSB1bmRlZmluZWQpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0NhblxcJ3QgZ2V0IGltYWdlIHdpZHRoL2hlaWdodCcpO1xuICB9XG4gIGNvbnN0IGN0eCA9IGF3YWl0IG1rY3R4KCdleGFtcGxlLmpwZycpO1xuICBjb25zdCBhY3Rpb24gPSBuZXcgQ3JvcEFjdGlvbigpO1xuICBhd2FpdCBhY3Rpb24ucHJvY2VzcyhjdHgsICdjcm9wLHhfMCx5XzAsd18xMDAwMCxoXzEwMDAwJy5zcGxpdCgnLCcpKTtcbiAgY29uc3QgeyBpbmZvIH0gPSBhd2FpdCBjdHguaW1hZ2UudG9CdWZmZXIoeyByZXNvbHZlV2l0aE9iamVjdDogdHJ1ZSB9KTtcbiAgZXhwZWN0KGluZm8ud2lkdGgpLnRvQmUobWV0YWRhdGEud2lkdGgpO1xuICBleHBlY3QoaW5mby5oZWlnaHQpLnRvQmUobWV0YWRhdGEuaGVpZ2h0KTtcbn0pO1xuIl19