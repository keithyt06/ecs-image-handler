"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ContrastAction = void 0;
const __1 = require("..");
const is = require("../../is");
const _base_1 = require("./_base");
class ContrastAction extends _base_1.BaseImageAction {
    constructor() {
        super(...arguments);
        this.name = 'contrast';
    }
    validate(params) {
        const opt = { contrast: -100 };
        if (params.length !== 2) {
            throw new __1.InvalidArgument('Contrast param error, e.g: contrast,-50');
        }
        const b = Number.parseInt(params[1], 10);
        if (is.inRange(b, -100, 100)) {
            opt.contrast = b;
        }
        else {
            throw new __1.InvalidArgument('Contrast must be between -100 and 100');
        }
        return opt;
    }
    async process(ctx, params) {
        const opt = this.validate(params);
        if (opt.contrast > 0) {
            ctx.image.linear((2 * opt.contrast + 100) / 200 + 0.5);
        }
        else {
            ctx.image.linear((opt.contrast + 100) / 200 + 0.5);
        }
    }
}
exports.ContrastAction = ContrastAction;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29udHJhc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvcHJvY2Vzc29yL2ltYWdlL2NvbnRyYXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUNBLDBCQUE0RDtBQUM1RCwrQkFBK0I7QUFDL0IsbUNBQTBDO0FBTTFDLE1BQWEsY0FBZSxTQUFRLHVCQUFlO0lBQW5EOztRQUNrQixTQUFJLEdBQVcsVUFBVSxDQUFDO0lBMkI1QyxDQUFDO0lBekJRLFFBQVEsQ0FBQyxNQUFnQjtRQUM5QixNQUFNLEdBQUcsR0FBaUIsRUFBRSxRQUFRLEVBQUUsQ0FBQyxHQUFHLEVBQUUsQ0FBQztRQUU3QyxJQUFJLE1BQU0sQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFO1lBQ3ZCLE1BQU0sSUFBSSxtQkFBZSxDQUFDLHlDQUF5QyxDQUFDLENBQUM7U0FDdEU7UUFDRCxNQUFNLENBQUMsR0FBRyxNQUFNLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQztRQUN6QyxJQUFJLEVBQUUsQ0FBQyxPQUFPLENBQUMsQ0FBQyxFQUFFLENBQUMsR0FBRyxFQUFFLEdBQUcsQ0FBQyxFQUFFO1lBQzVCLEdBQUcsQ0FBQyxRQUFRLEdBQUcsQ0FBQyxDQUFDO1NBQ2xCO2FBQU07WUFDTCxNQUFNLElBQUksbUJBQWUsQ0FBQyx1Q0FBdUMsQ0FBQyxDQUFDO1NBQ3BFO1FBQ0QsT0FBTyxHQUFHLENBQUM7SUFDYixDQUFDO0lBR00sS0FBSyxDQUFDLE9BQU8sQ0FBQyxHQUFrQixFQUFFLE1BQWdCO1FBQ3ZELE1BQU0sR0FBRyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUM7UUFFbEMsSUFBSSxHQUFHLENBQUMsUUFBUSxHQUFHLENBQUMsRUFBRTtZQUNwQixHQUFHLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUMsUUFBUSxHQUFHLEdBQUcsQ0FBQyxHQUFHLEdBQUcsR0FBRyxHQUFHLENBQUMsQ0FBQztTQUN4RDthQUFNO1lBQ0wsR0FBRyxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxHQUFHLENBQUMsUUFBUSxHQUFHLEdBQUcsQ0FBQyxHQUFHLEdBQUcsR0FBRyxHQUFHLENBQUMsQ0FBQztTQUNwRDtJQUNILENBQUM7Q0FDRjtBQTVCRCx3Q0E0QkMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJSW1hZ2VDb250ZXh0IH0gZnJvbSAnLic7XG5pbXBvcnQgeyBJQWN0aW9uT3B0cywgUmVhZE9ubHksIEludmFsaWRBcmd1bWVudCB9IGZyb20gJy4uJztcbmltcG9ydCAqIGFzIGlzIGZyb20gJy4uLy4uL2lzJztcbmltcG9ydCB7IEJhc2VJbWFnZUFjdGlvbiB9IGZyb20gJy4vX2Jhc2UnO1xuXG5leHBvcnQgaW50ZXJmYWNlIENvbnRyYXN0T3B0cyBleHRlbmRzIElBY3Rpb25PcHRzIHtcbiAgY29udHJhc3Q6IG51bWJlcjtcbn1cblxuZXhwb3J0IGNsYXNzIENvbnRyYXN0QWN0aW9uIGV4dGVuZHMgQmFzZUltYWdlQWN0aW9uIHtcbiAgcHVibGljIHJlYWRvbmx5IG5hbWU6IHN0cmluZyA9ICdjb250cmFzdCc7XG5cbiAgcHVibGljIHZhbGlkYXRlKHBhcmFtczogc3RyaW5nW10pOiBSZWFkT25seTxDb250cmFzdE9wdHM+IHtcbiAgICBjb25zdCBvcHQ6IENvbnRyYXN0T3B0cyA9IHsgY29udHJhc3Q6IC0xMDAgfTtcblxuICAgIGlmIChwYXJhbXMubGVuZ3RoICE9PSAyKSB7XG4gICAgICB0aHJvdyBuZXcgSW52YWxpZEFyZ3VtZW50KCdDb250cmFzdCBwYXJhbSBlcnJvciwgZS5nOiBjb250cmFzdCwtNTAnKTtcbiAgICB9XG4gICAgY29uc3QgYiA9IE51bWJlci5wYXJzZUludChwYXJhbXNbMV0sIDEwKTtcbiAgICBpZiAoaXMuaW5SYW5nZShiLCAtMTAwLCAxMDApKSB7XG4gICAgICBvcHQuY29udHJhc3QgPSBiO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBuZXcgSW52YWxpZEFyZ3VtZW50KCdDb250cmFzdCBtdXN0IGJlIGJldHdlZW4gLTEwMCBhbmQgMTAwJyk7XG4gICAgfVxuICAgIHJldHVybiBvcHQ7XG4gIH1cblxuXG4gIHB1YmxpYyBhc3luYyBwcm9jZXNzKGN0eDogSUltYWdlQ29udGV4dCwgcGFyYW1zOiBzdHJpbmdbXSk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IG9wdCA9IHRoaXMudmFsaWRhdGUocGFyYW1zKTtcblxuICAgIGlmIChvcHQuY29udHJhc3QgPiAwKSB7XG4gICAgICBjdHguaW1hZ2UubGluZWFyKCgyICogb3B0LmNvbnRyYXN0ICsgMTAwKSAvIDIwMCArIDAuNSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGN0eC5pbWFnZS5saW5lYXIoKG9wdC5jb250cmFzdCArIDEwMCkgLyAyMDAgKyAwLjUpO1xuICAgIH1cbiAgfVxufSJdfQ==