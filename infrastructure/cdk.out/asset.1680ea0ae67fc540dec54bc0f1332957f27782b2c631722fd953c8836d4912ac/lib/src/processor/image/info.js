"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.InfoAction = void 0;
const __1 = require("..");
const _base_1 = require("./_base");
class InfoAction extends _base_1.BaseImageAction {
    constructor() {
        super(...arguments);
        this.name = 'info';
    }
    beforeProcess(ctx, _2, index) {
        ctx.mask.disableAll();
        ctx.mask.enable(index);
    }
    validate(params) {
        if ((params.length !== 1) || (params[0] !== this.name)) {
            throw new __1.InvalidArgument('Info param error');
        }
        return {};
    }
    async process(ctx, params) {
        var _a;
        this.validate(params);
        const metadata = await ctx.image.metadata();
        ctx.info = {
            FileSize: { value: String(metadata.size) },
            Format: { value: String(metadata.format === 'jpeg' ? 'jpg' : metadata.format) },
            ImageHeight: { value: String((_a = metadata.pageHeight) !== null && _a !== void 0 ? _a : metadata.height) },
            ImageWidth: { value: String(metadata.width) },
        };
        ctx.features[__1.Features.ReturnInfo] = true;
    }
}
exports.InfoAction = InfoAction;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5mby5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9wcm9jZXNzb3IvaW1hZ2UvaW5mby50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFDQSwwQkFBc0U7QUFDdEUsbUNBQTBDO0FBRzFDLE1BQWEsVUFBVyxTQUFRLHVCQUFlO0lBQS9DOztRQUNrQixTQUFJLEdBQVcsTUFBTSxDQUFDO0lBMkJ4QyxDQUFDO0lBekJRLGFBQWEsQ0FBQyxHQUFrQixFQUFFLEVBQVksRUFBRSxLQUFhO1FBQ2xFLEdBQUcsQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFFLENBQUM7UUFDdEIsR0FBRyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDekIsQ0FBQztJQUVNLFFBQVEsQ0FBQyxNQUFnQjtRQUM5QixJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsS0FBSyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUU7WUFDdEQsTUFBTSxJQUFJLG1CQUFlLENBQUMsa0JBQWtCLENBQUMsQ0FBQztTQUMvQztRQUNELE9BQU8sRUFBRSxDQUFDO0lBQ1osQ0FBQztJQUVNLEtBQUssQ0FBQyxPQUFPLENBQUMsR0FBa0IsRUFBRSxNQUFnQjs7UUFDdkQsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUV0QixNQUFNLFFBQVEsR0FBRyxNQUFNLEdBQUcsQ0FBQyxLQUFLLENBQUMsUUFBUSxFQUFFLENBQUM7UUFDNUMsR0FBRyxDQUFDLElBQUksR0FBRztZQUNULFFBQVEsRUFBRSxFQUFFLEtBQUssRUFBRSxNQUFNLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxFQUFFO1lBQzFDLE1BQU0sRUFBRSxFQUFFLEtBQUssRUFBRSxNQUFNLENBQUMsUUFBUSxDQUFDLE1BQU0sS0FBSyxNQUFNLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxFQUFFO1lBQy9FLFdBQVcsRUFBRSxFQUFFLEtBQUssRUFBRSxNQUFNLENBQUMsTUFBQSxRQUFRLENBQUMsVUFBVSxtQ0FBSSxRQUFRLENBQUMsTUFBTSxDQUFDLEVBQUU7WUFDdEUsVUFBVSxFQUFFLEVBQUUsS0FBSyxFQUFFLE1BQU0sQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLEVBQUU7U0FDOUMsQ0FBQztRQUVGLEdBQUcsQ0FBQyxRQUFRLENBQUMsWUFBUSxDQUFDLFVBQVUsQ0FBQyxHQUFHLElBQUksQ0FBQztJQUMzQyxDQUFDO0NBQ0Y7QUE1QkQsZ0NBNEJDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSUltYWdlQ29udGV4dCB9IGZyb20gJy4nO1xuaW1wb3J0IHsgSUFjdGlvbk9wdHMsIFJlYWRPbmx5LCBJbnZhbGlkQXJndW1lbnQsIEZlYXR1cmVzIH0gZnJvbSAnLi4nO1xuaW1wb3J0IHsgQmFzZUltYWdlQWN0aW9uIH0gZnJvbSAnLi9fYmFzZSc7XG5cblxuZXhwb3J0IGNsYXNzIEluZm9BY3Rpb24gZXh0ZW5kcyBCYXNlSW1hZ2VBY3Rpb24ge1xuICBwdWJsaWMgcmVhZG9ubHkgbmFtZTogc3RyaW5nID0gJ2luZm8nO1xuXG4gIHB1YmxpYyBiZWZvcmVQcm9jZXNzKGN0eDogSUltYWdlQ29udGV4dCwgXzI6IHN0cmluZ1tdLCBpbmRleDogbnVtYmVyKTogdm9pZCB7XG4gICAgY3R4Lm1hc2suZGlzYWJsZUFsbCgpO1xuICAgIGN0eC5tYXNrLmVuYWJsZShpbmRleCk7XG4gIH1cblxuICBwdWJsaWMgdmFsaWRhdGUocGFyYW1zOiBzdHJpbmdbXSk6IFJlYWRPbmx5PElBY3Rpb25PcHRzPiB7XG4gICAgaWYgKChwYXJhbXMubGVuZ3RoICE9PSAxKSB8fCAocGFyYW1zWzBdICE9PSB0aGlzLm5hbWUpKSB7XG4gICAgICB0aHJvdyBuZXcgSW52YWxpZEFyZ3VtZW50KCdJbmZvIHBhcmFtIGVycm9yJyk7XG4gICAgfVxuICAgIHJldHVybiB7fTtcbiAgfVxuXG4gIHB1YmxpYyBhc3luYyBwcm9jZXNzKGN0eDogSUltYWdlQ29udGV4dCwgcGFyYW1zOiBzdHJpbmdbXSk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRoaXMudmFsaWRhdGUocGFyYW1zKTtcblxuICAgIGNvbnN0IG1ldGFkYXRhID0gYXdhaXQgY3R4LmltYWdlLm1ldGFkYXRhKCk7XG4gICAgY3R4LmluZm8gPSB7XG4gICAgICBGaWxlU2l6ZTogeyB2YWx1ZTogU3RyaW5nKG1ldGFkYXRhLnNpemUpIH0sXG4gICAgICBGb3JtYXQ6IHsgdmFsdWU6IFN0cmluZyhtZXRhZGF0YS5mb3JtYXQgPT09ICdqcGVnJyA/ICdqcGcnIDogbWV0YWRhdGEuZm9ybWF0KSB9LFxuICAgICAgSW1hZ2VIZWlnaHQ6IHsgdmFsdWU6IFN0cmluZyhtZXRhZGF0YS5wYWdlSGVpZ2h0ID8/IG1ldGFkYXRhLmhlaWdodCkgfSxcbiAgICAgIEltYWdlV2lkdGg6IHsgdmFsdWU6IFN0cmluZyhtZXRhZGF0YS53aWR0aCkgfSxcbiAgICB9O1xuXG4gICAgY3R4LmZlYXR1cmVzW0ZlYXR1cmVzLlJldHVybkluZm9dID0gdHJ1ZTtcbiAgfVxufSJdfQ==